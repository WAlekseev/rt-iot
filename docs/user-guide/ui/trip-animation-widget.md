---
layout: docwithnav
title: Виджет анимации перемещения
description: Виджет анимации перемещения
---


* TOC
{:toc}
Общие сведения

В этом примере мы изучим функциональность виджета анимации перемещения (Trip-анимации.)

Этот виджет имеет несколько вариантов использования, но в основном он используется для real-time трэккинга, отслеживания движения объектов и его визуализации.

## Настройка виджета trip-анимации

Во-первых, вам нужно создать устройство, с которого будет собираться телеметрия.

Кроме того, вы можете использовать любое имеющееся у вас устройство с координатной телеметрией (долгота и широта).

Это может быть любое устройство, которое получает свои координаты в реальном времени.

Наше устройство получает свою долготу, широту, скорость, статус и координаты полигона.

Долгота и широта являются ключевыми данными для визуализации карты, так что вы увидите их в виджете на дашборде, которой выбрали.

В нашем примере мы используем эмулятор, написанный на javascript для получения телеметрии и визуализации ее на дашборде.


### Создание дашборда

Нам нужно создать дашборд где будет визуализироваться телеметрия. Это необходимо, если ваша цель состоит в том, чтобы отслеживать, как ваша сущность перемещалась в определенный период времени.

Мы можем использовать существующий дашборд или создать новый для нашего нового варианта использования.

В обучающих целях мы создаем новый дашборд под названием "Дашборд1".

### Добавление виджета

Теперь мы откроем нашу пустой дашборд и отредактируем его. 

![image](/images/user-guide/ui/widgets/trip-animation-widget/1.png)

Теперь у нас есть пустой дашборд. Давайте наполним его каким-нибудь содержанием

![image](/images/user-guide/ui/widgets/trip-animation-widget/2.png)

Во-первых, нам нужно создать псевдоним, чтобы указать сущность, от которой мы будем получать телеметрические данные.

Нашей сущностью в этом руководстве будет устройство "Tracker1", которое мы создали ранее. Мы зададим псевдоним “GeoData1".

![image](/images/user-guide/ui/widgets/trip-animation-widget/3.png)

Теперь мы переходим к добавлению виджета.

![image](/images/user-guide/ui/widgets/trip-animation-widget/4.png)

Виджет trip-анимации находится в пакете «Карты»

![image](/images/user-guide/ui/widgets/trip-animation-widget/5.png)

В нашем виджете мы добавляем координаты, широту, долготу, скорость и статус из псевдонима “GeoData1” в качестве наших параметров.

Они имеют те же метки, что и их ключи. Во-вторых, мы создаем виджет, на котором будем визуализировать нашу телеметрию.

Мы используем виджет trip-анимации в нашем руководстве. Он находится в пакете «Карты», вкладка «Временные ряды».

Кроме того, мы перейдем к “Use dashboard timewindow”, чтобы упростить синхронизацию наших данных.

![image](/images/user-guide/ui/widgets/trip-animation-widget/6.png)

Кроме того, мы будем использовать полученные в последнюю минуту данные, чтобы их визуализировать и изменять функцию агрегации на «None», потому что нам не нужно угадывать возможное значение данных для следующего периода времени – мы получаем данные в реальном времени без каких-либо ошибок.

![image](/images/user-guide/ui/widgets/trip-animation-widget/8.png)

Наконец, мы включаем наш эмулятор (ссылку на него вы можете найти ниже, в разделе “Эмулятор устройства”).

![image](/images/user-guide/ui/widgets/trip-animation-widget/9.png)

### Виджет готов

Теперь мы можем посмотреть, как наше устройство движется в течение последней минуты в режиме реального времени.

Мы также можем ускорить наш курсор временной шкалы в 1,5,10,25 раз, чтобы сделать проверку его маршрутизации намного быстрее.

Не забудьте нажать кнопку “Пуск”.


![image](/images/user-guide/ui/widgets/trip-animation-widget/3.gif)

## Настройки

### Вкладка настройки

Теперь, когда мы имеем представление о том, что обеспечивает наш виджет, давайте перейдем к редактированию его настроек, чтобы сделать его более функциональным и привлекательным. Во-первых, мы идем в настройки, там мы можем указать:

* Название виджета и его стиль

* Значок заголовка, цвет значка, размер значка в пикселях

* Всплывающая подсказка заголовка: Показать/Скрыть

* Включение/выключение падения тени

* Включение/выключение полноэкранного режима для виджета

* Изменить стиль виджета

* Включить/отключить экспорт данных

* Цвет фона, цвет текста, отступы, поля

* Указать настройки мобильного телефона

Давайте посмотрим, как это работает.

![image](/images/user-guide/ui/widgets/trip-animation-widget/4.gif)

### Вкладка «Дополнительно»

Чтобы добиться большей функциональности, вкладке «Настройки» мы можем указать уникальные параметры для виджета trip-анимации. У нас есть:

![image](/images/user-guide/ui/widgets/trip-animation-widget/15.png)

* •	Поставщик карт 

![image](/images/user-guide/ui/widgets/trip-animation-widget/16.png)

* Нормализация данных (ms) 

* Ключевые имена широты и долготы – вы можете указать имя, на основе которого виджет будет обновляться. Он использует данные, основанные на метке данных. Вы можете указать метку “data-1” в значении ключа долготы и, после того, как параметр отредактирован, получить долготу из псевдонима. 

![image](/images/user-guide/ui/widgets/trip-animation-widget/7.gif)

* Метка виджета или функция спецификации метки (Вы можете изменить данные, содержащиеся в метке виджета, на основе данных, dsData, dsIndex)

![image](/images/user-guide/ui/widgets/trip-animation-widget/5.gif)
 
Label function:
```javascript
var speed = dsData['speed'];
var res;
if (speed > 55) {
    res = "Too Fast"
} else {
    res = "Everything is OK"
}
return res;

```

* Показать/Скрыть всплывающую подсказку, ее цвет, цвет шрифта, непрозрачность её и текста или использовать функцию всплывающей подсказки (вы можете изменить данные, содержащиеся во всплывающей подсказке, на основе данных, dsData, dsIndex)

![image](/images/user-guide/ui/widgets/trip-animation-widget/6.gif)

Tooltip function:
```javascript
var speed = dsData['speed'];
var res;
if (speed > 0) {
    res = "${entityName} <b>Speed:</b> " + String(speed)
} else {
    res = "On The stop"
}
return res;

```

* Цвет пути или функция спецификации цвета пути (вы можете изменить данные, содержащиеся во всплывающей подсказке, на основе данных, dsData, dsIndex) - цвет маркера изменяется

![image](/images/user-guide/ui/widgets/trip-animation-widget/26.png)

Path color function:
```javascript
var speed = dsData['speed'];
var res;
if (speed > 50) {
    res = "red"
} else {
    res = "green"
}
return res;
```

* Декоратор пути, его размер в пикселях, смещение конца/начала, ретранслятор декоратора, толщина и непрозрачность штриха

![image](/images/user-guide/ui/widgets/trip-animation-widget/27.png)

#### Параметры полигона

Что такое полигон? Это плоская фигура, которая описывается конечным числом точек. Мы используем полигон, который основан на координатах, указанных в устройстве, которое мы используем, но вы можете использовать любую другую сущность.

Вы можете пометить свои активы и любые другие объекты параметром полигона. Для полигона мы можем задать следующие настройки. Координаты полигона принимаются в формате:


```
[[1CoordinateLatitude,1CoordinateLatitude],[2CoordinateLatitude,2CoordinateLatitude]...[nCoordinateLatitude,nCoordinateLatitude]]
``` 

где n – число координат, которыми описывается многоугольник.

* Показать/cкрыть полигон

* Текст или функция подсказки полигона (вы можете изменить данные, содержащиеся в подсказке полигона, на основе данных, dsData, dsIndex)

* Цвет и непрозрачность полигона

* Цвет границы полигона, непрозрачность, толщина

* Функция цвета полигона (вы можете изменить цвет полигона на основе данных, dsData, dsIndex)


![image](/images/user-guide/ui/widgets/trip-animation-widget/28.png)

#### Настройки точек

Следующая опция – это опция «показать точки». Точки – это обновления телеметрических данных, так что вы можете проверить каждую из них. Для точек доступны следующие опции.

* Показать/Скрыть точки

* Цвет точки

* Размер точки в пикселях

* Использовать точку в качестве якоря или якорной функции (вы можете изменить данные, содержащиеся во всплывающей подсказке полигона, на основе данных, dsData, dsIndex)

* Независимая подсказка

* Самозакрывающийся поп-ап


![image](/images/user-guide/ui/widgets/trip-animation-widget/2.gif)

#### Параметры маркера

IКроме того, есть некоторые параметры маркера, которые вы можете задать:

* Цвет маркера по умолчанию

* Пользовательское изображение маркера

* Пользовательский размер изображения маркера в пикселях

* Установить дополнительный угол поворота маркера

* Функция изображения маркера (вы можете изменить изображение маркера и его цвет на основе данных, dsData, dsIndex)

* Указать другие возможные изображения маркеров, которые можно использовать в соответствующей функции


![image](/images/user-guide/ui/widgets/trip-animation-widget/1.gif)

Marker image function:
```javascript
var speed = dsData['speed'];
var res;
if (speed > 55) {
    res = images[0];
} else {
    res = images[1];
}
return res;
```

## Видеоинструкция
 
Также мы рекомендуем вам ознакомиться с этой видеоинструкцией

  
<div id="video">  
    <div id="video_wrapper">
        <iframe src="https://www.youtube.com/embed/qWCmDjca-T8" frameborder="0" allowfullscreen></iframe>
    </div>
</div>


## Эмулятор устройства
 
[Эмулятор](/docs/user-guide/resources/timeseries-map-bus.js)

Для того, чтобы выполнить скрипт, перейдите в командную строку:
```bash
node timeseries-map-bus.js $ACCESSTOKEN
```
Где **$ACCESSTOKEN** это **access token** вашего **устройства**

**$ACCESSTOKEN** находится в **Device details**. 
![image](/images/user-guide/ui/widgets/trip-animation-widget/34.png)

Эмулятор может работать с Node.js v8.10.0
 
