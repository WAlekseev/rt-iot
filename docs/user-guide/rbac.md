---
title: Расширенный контроль доступа (RBAC)
description:  Расширенный контроль доступа (RBAC)
---

{% assign feature = "Advanced RBAC for IoT devices and applications" %}{% include templates/pe-feature-banner.md %}

* TOC
{:toc}


Смотрите пошаговую видео-инструкцию к этой функции ниже.

<br/>
<div id="video">  
    <div id="video_wrapper">
        <iframe src="https://www.youtube.com/embed/xpnYzSiDiJo" frameborder="0" allowfullscreen></iframe>
    </div>
</div> 

##Глоссарий
 
**Тенант**

Можно рассматривать тенант как отдельную бизнес-сущность: физическое лицо или организацию, которая владеет или производит устройства и активы. У тенанта может быть несколько тенант-администраторов и множество клиентов.

**Сущность**

Любая сущность, управляемая платформой. Например: устройство, актив, пользователь, дашборд, вид сущности и т. д. Дополнительные сведения см. в [руководстве по сущностям и их отношениям](/docs/user-guide/entities-and-relations/).

**Группа сущностей (EG)** 

Это группы сущностей одного типа, например, группа устройств или группа активов. Одна сущность может принадлежать одновременно нескольким группам сущностей. Например, термостат может принадлежать к группе “термостаты”, которая содержит все устройства, и к более конкретной группе, например, “термостаты с прошивкой v1.2.3”.

**Клиентr**

Клиент может быть отдельным бизнес-субъектом: физическим лицом или организацией, которые покупают или используют устройства тенанта или объекты. Клиент также может быть подразделением внутри организации-тенанта. Клиент может иметь несколько пользователей, внутренних клиентов и множество устройств и/или объектов.

**Группа клиентов (CG)**

Группа клиентов также является и группой сущностей. Она имеет те же функции, что и обычная группа сущностей, но у нас есть отдельный термин для CG, чтобы легко различать CG и все остальные группы сущностей.

**Пользовательr**

Пользователи могут входить в веб-интерфейс платформы, выполнять вызовы REST API, получать доступ к устройствам и ресурсам, если у них есть на это полномочия. Пользователь также является сущностью в платформе.

**Группа пользователей (UG)**

Группа пользователей также является группой сущностей. Она имеет те же особенности, что и обычная группа сущностей, но у нас есть отдельный термин для UG, чтобы легко различать UG и все остальные группы сущностей.

**Владелец**

Каждая EG принадлежит одному владельцу. Это может быть как тенант, так и клиент. Кроме того, у каждого клиента также есть только один владелец. Если владелец клиента является тенантом, это означает, что это клиент верхнего уровня. Если владельцем клиента является другой клиент, это означает, что это суб-клиент. На платформе может быть несколько уровней клиентов.

**Ресурс**

Все, что имеет защищенные API или представляет сущность платформы, является ресурсом. Примеры сущностей перечислены в её определении, приведенном выше. Группы сущностей также являются ресурсами, например: группа устройств, группа активов, группа дашбордов. Дополнительные ресурсы – это white-labeling, журналы аудита и настройки администратора.

**Операции**

Операции представляют собой действия, которые можно выполнять с ресурсами. Существуют общие действия, такие как “создать”, “прочитать”, “написать”, “удалить”, “добавить в группу”, “удалить из группы". Существуют также особые действия, такие как “чтение/запись учетных данных”.

**Роли**

Роль содержит список ресурсов и разрешенных операций для каждого из этих ресурсов. Существует два типа ролей: общие и групповые. Существует специальный ресурс “All”, который является ярлыком для всех доступных типов ресурсов. Существует также специальная операция “All”, которая является кратчайшим путем ко всем возможным операциям.
Мы объясним различия между ними чуть ниже в этой статье.
  
 
**Групповые разрешения объекта (GPE)**

GPE – это по сути соотношение UG, роли и (опционально) EG. Дополнительные сведения см. в разделах “Общие роли” и “Групповые роли”.

## Иерархия клиентов

Платформа поддерживает “рекурсивную” иерархию клиентов с неограниченным количеством суб-клиентов. Владельцем корневого уровня является тенант. Каждый владелец может иметь несколько групп сущностей (EGs), групп пользователей (UGs) и групп клиентов (CGs).
**Примечание:** каждая сущность имеет ровно одного владельца. Однако сущности могут относиться к нескольким EGs, принадлежащим одному и тому же владельцу.
Поскольку CGs может содержать несколько клиентов, каждый клиент может также владеть своими EGs, UGs и CGs (т. е. подгруппами клиентов). См. диаграмму ниже для визуального представления отношений между этими сущностями.

 
![image](/images/user-guide/security/customer-hierarchy-diagram.png)

## Роли

Роль соотносит тип ресурса со списком разрешенных операций. Существует два типа ролей: общие и групповые.

### Общие роли

Каждая роль связана с одной или несколькими группами пользователей (UG). У каждой группы пользователей (UG) есть только один владелец. С помощью общей роли вы предоставляете UG одинаковые разрешения для всех сущностей, принадлежащих одному владельцу, и всех его суб-клиентов рекурсивно. Мы используем специальный объект “соединение”, называемый «сущностью разрешения группы (GPE)», чтобы установить соединение между группой пользователей и общей ролью.

Рассмотрим диаграмму ниже.

Пользователь Иван сможет выполнять любые операции над любой сущностью, принадлежащей либо его тенанту A, либо клиенту B, так же долго, как и любые другие клиенты и суб-клиенты, для того же тенанта. Однако пользователь Алиса сможет выполнять любые операции над любой сущностью, которая принадлежит только ее клиенту B и всем его суб-клиентам. Таким образом, Алиса и Иван могут получить доступ к устройству B1, но только Иван может получить доступ к устройству A1.

![image](/images/user-guide/security/generic-role-diagram.png)

### Групповые роли

Групповая роль позволяет соотнести набор разрешений для конкретной группы пользователей (UG) с конкретной группой сущностей (EG). Мы используем специальный объект “соединение”, называемый сущностью разрешения группы (GPE), чтобы установить соединение между группой пользователей (UG), группой сущностей (EG) и групповой ролью.

Рассмотрим диаграмму ниже.
Пользователь Иван принадлежит к группе “тенант-администраторы” и может выполнять любые операции с любыми объектами тенантов. В основном Иван имеет полный контроль над обеими группами устройств A и B. пользователь Алиса принадлежит к “администраторам группы A” и имеет доступ к чтению/записи всех устройств в группе A. Однако Алиса не сможет видеть или использовать устройства из группы B.

![image](/images/user-guide/security/group-role-diagram.png)      

**Примечание:** поскольку группа сущностей (EG) имеет ровно одного владельца, вы можете назначить групповую роль любой группе пользователей, принадлежащей тому же владельцу или любому из родителей владельца.

## Примеры

См. список примеров конфигурации ниже для наиболее популярных вариантов использования.

### Умное здание: отдельные группы пользователей (UG) для каждого объекта

Предположим, что ваше приложение управляет коммерческими зданиями. Ваш основной клиент - это менеджер здания, который хочет контролировать инженерные системы, потребление электроэнергии и другие умные устройства в здании.
Менеджер здания может захотеть спроектировать и поделиться некоторыми дашбордами с конечными пользователями - офисными работниками. Кроме того, ваши инженеры, ответственные за техническое обслуживание, заинтересованы в том, чтобы контролировать состояние устройств, например, получать оповещения, когда уровень заряда батареи для них опускается ниже пороговых значений.
Чтобы суммировать эти требования в терминах платформы, мы должны реализовать следующие роли:


* Supervisors – read-only доступ ко всем устройствам телеметрии во всех зданиях и возможность создавать свои собственные дашборды, но нет доступа к дашбордам, созданным пользователями из разных групп (UG).
* Facility Managers – позволяет создавать новые устройства для каждого объекта, устанавливать пороговые значения, управлять пользователями и настраивать дашборды.
* End Users – позволяет иметь read-only доступ к состоянию объекта, к которому принадлежит этот пользователь.


Давайте настроим платформу для поддержки этого варианта использования. В приведенных ниже инструкциях предполагается, что вы вошли в систему как клиент-администратор.

**Супервайзеры**

Мы создадим отдельную группу пользователей с именем “супервайзеры” и отдельную группу дашбордов “дашборды супервайзеров”. Наша цель состоит в том, чтобы позволить супервайзерам управлять дашбордами в группе “дашборды супервайзеров”, но для всех других сущностей в системе они должны иметь read-only доступ.
Давайте начнем с создания группы “дашборды супервайзеров”. Смотрите скриншот ниже.

<img data-gifffer="/images/user-guide/security/smart-buildings-dashboards-group.gif" />

Мы должны создать две роли для реализации этого варианта использования:

“Все read-only сущности” – общая роль, которая позволит получить доступ ко всем данным сущностей и принимать учетные данные устройства. Смотрите скриншот ниже:

<img data-gifffer="/images/user-guide/security/smart-buildings-role1.gif" /> 
 
* Администратор группы сущностей” – групповая роль, которая разрешает все операции для группы. Смотрите скриншот ниже:

<img data-gifffer="/images/user-guide/security/smart-buildings-role2.gif" />
  
Мы назначим эти роли группе “супервайзеры”. Смотрите скриншотт ниже

<img data-gifffer="/images/user-guide/security/smart-buildings-user-group.gif" />
 
**Facility managers**

Мы создадим отдельную клиентскую сущность для каждого здания или группы зданий. Мы добавим учетную запись Facility Manager-пользователя в группу “Клиенты-администраторы”, которая автоматически создается для каждого клиента. Как менеджер объекта, мы теперь можем входить в систему, проектировать панели мониторинга, обеспечивать устройства и end users.
  
<img data-gifffer="/images/user-guide/security/smart-buildings-building-a.gif" />  

**Конечные пользователи**

Давайте войдем в систему как Алиса (аккаунт создан в предыдущем скриншоте), Building A администратор, и создадим несколько панелей мониторинга. Чтобы упростить это руководство, мы не будем демонстрировать конкретные шаги создания панели мониторинга (есть множество доступных руководств).
      
![image](/images/user-guide/security/smart-buildings-building-a-dashboards.png)

Теперь давайте создадим read-only пользователя. Предположим, что мы хотим назначить ему “конечный пользователь дашборда” и убедиться, что эта панель откроется во весь экран, как только пользователь войдет в систему. Таким образом, наш read-only пользователь не будет иметь доступа к административной панели слева, так как ему все еще не разрешено выполнять какие-либо server-side API-вызовы, кроме read-only просмотра данных.   

<img data-gifffer="/images/user-guide/security/smart-buildings-read-only-user.gif" />
 
