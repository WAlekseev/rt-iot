---
layout: docwithnav
title: Планировщик
description: Планировщик

---

* TOC
{:toc}

### Oбзор

Платформа позволяет планировать различные типы событий с гибкой конфигурацией расписания. Планировщик платформы запускает настроенные события планировщика в соответствии с их расписанием. При запуске события планировщика сообщение движка правил генерируется на основе конфигурации события, которая имеет аналогичную структуру с сообщением движка правил. Сгенерированное сообщение затем пересылается в движок правил и обрабатывается, начиная с [корневой цепочки правил](/docs/user-guide/rule-engine-2-0/overview/#rule-chain).


![image](/images/user-guide/scheduler.svg)

### Видео-руководство

Смотрите пошаговую видео-инструкцию ниже, чтобы узнать, как использовать эту функцию.

<br/>
<div id="video">  
    <div id="video_wrapper">
        <iframe src="https://www.youtube.com/embed/RnHAao8yET4" frameborder="0" allowfullscreen></iframe>
    </div>
</div> 

### Администрирование планировщика

Тенант администратор и пользователи-клиенты могут настраивать события планировщика в платформе.

![image](/images/user-guide/ui/scheduler.png)

Страница **событий планировщика** отображает текущие настроенные события планировщика. Она позволяет добавлять, обновлять или удалять события планировщика. Страница может быть отображена в двух режимах: как список и как календарь. Режимы можно переключать, нажимая на соответствующие значки в верху страницы.

![image](/images/user-guide/ui/scheduler-view-buttons.png)

В режиме календаря события планировщика представлены как метки, соответствующие расписанию. 
  
![image](/images/user-guide/ui/scheduler-calendar-view.png)

По умолчанию календарь представлен в месячном режиме.

Выпадающий список «Вид календаря» позволяет переключить режим отображения. Можно выбрать следующие:

Месяц / Неделя / День / Годичный список / Месячный список / Недельный список / Дневной список / Повестка недели / Повестка дня

Новое событие планировщика можно создать, нажав на кнопку + в правом верхнем углу или на любую ячейку календаря.

#### Диалог событий планировщика

Диалог редактирования событий планировщика состоит из двух форм: **конфигурации** и **расписание**.

![image](/images/user-guide/ui/scheduler-event-dialog.png)

**Форма конфигурации** позволяет задать тип события и соответствующие ему параметры. Конфигурация события планировщика описана в разделе «Типы событий планировщика».

**Форма расписания** позволяет настроить расписание событий.

![image](/images/user-guide/ui/scheduler-event-schedule.png)

Schedule form has the following parameters:

-Форма расписания имеет следующие параметры:
 - **Часовой пояс** - часовой пояс, в котором должно обрабатываться данное событие планировщика.
 - **Дата/время начала** – дата/время, когда это событие планировщика должно быть запущено.
 - **Повторение** - если это событие планировщика является однократным или должно быть повторено.
 - **Повторения** - правило повтора, может быть как ежедневным, так и еженедельным.
 - **Повторение в…** - применяется для еженедельного повтора. Указываются дни недели, когда это событие планировщика должно быть запущено.
 - **Повторение до…** - дата, до которой событие планировщика должно повторяться.
 

### Типы событий планировщика

В поле «Тип события» в форме конфигурации можно выбрать существующий тип события или указать пользовательский.

#### Пользовательский тип

Используется исходная форма конфигурации событий планировщика, соответствующую структуре сообщения.

![image](/images/user-guide/ui/scheduler-custom-event-type.png)

 - **Инициатор** - может быть одиночным объектом (например, устройством, активом и т.д.) или их группой. Если это не указано, то сама event-сущность планировщика будет считаться инициатором.
 - **Тип сообщения** - тип сообщения, соответствующий оным в движкe правил. Может использоваться существующий или пользовательский. Если он не указан, то тип события планировщика будет рассматриваться как тип сообщения.
 - **Тело сообщения** - тело сообщения в представлении JSON.
 - **Метаданные** - таблица ключ/значение, отображающая поля метаданных сообщения.


#### Генерирование отчетов

Позволяет планировать генерацию отчетов, поддерживаемых функцией Reporting.

![image](/images/user-guide/ui/scheduler-generate-report-event-type-report-config.png)

![image](/images/user-guide/ui/scheduler-generate-report-event-type-email-config.png)

- **Настройка отчета**:
    - **Базовый URL-адрес** – базовый URL пользовательского интерфейса платформы, который должен быть доступен Report Server’у.
    - **Дашборд** - дашборд, который будет использоваться для генерации отчетов.
    - **Значение параметра состояния дашборда** - используется для указания целевого состояния дашборда, чтобы сформировать отчет. Можно установить автоматически, нажав на крайнюю кнопку вызвав диалоговое окно «Select dashboard state»..       
    - **Часовой пояс** - часовой пояс, в котором целевой дашборд будет представлен в отчете.
    - **Использовать временное окно дашборда** - если оно задано, то при создании отчета будет использоваться временное окно, настроенное в целевом дашборде.
    - **Timewindow** - конкретное временное окно, которое будет использоваться при создании отчета.
    - **Паттерн имени отчета** - может содержать date-time-паттерн вида %d{date-time pattern}. Подробные сведения о date-time-паттерне см. в документации [SimpleDateFormat](https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html).
    - **Тип файла отчета** - тип файла отчета, может быть PDF | PNG | JPEG.
    - **Использовать текущие учетные данные пользователя** - если они установлены, учетные данные пользователя, создавшего эту отчетную конфигурацию, будут использоваться для открытия UI панели мониторинга во время создания отчета.
    - **Учетные данные пользователя-клиента** - целевой пользователь-клиент, учетные данные которого будут использоваться для открытия UI панели мониторинга во время создания отчета.
    - **Кнопка «Создать тестовый отчет»** -  используется в целях тестирования. Она запускает процесс генерации отчета с предоставленной конфигурацией. Полученный файл отчета будет автоматически загружен, если его генерация пройдет успешно.
    
- **Отправить email** - если задано, будет отправлен email с файлом отчета во вложении.

- **Настрояка Email**:
    - **From** - От
    - **To** - Адреса получателей через запятую
    - **Cc** - Список адресов через запятую
    - **Bcc** - Список адресов через запятую
    - **Subject** - может содержать date-time-паттерн вида %d{date-time pattern}, соответствующий [SimpleDateFormat](https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html).
    - **Body** - Тело письма, может содержать date-time-паттерн вида %d{date-time pattern}, соответствующий [SimpleDateFormat](https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html).

#### Обновление атрибутов

Позволяет запланировать обновление атрибутов для объекта или их группы.

![image](/images/user-guide/ui/scheduler-update-attributes-event-type.png)

- **Цель** - целевой объект, атрибуты которого должны быть обновлены, может быть как одним объектом (например, устройство, актив и т.д.), так и их группой.
- **Область действий атрибутов объекта** - область действия обновленных атрибутов. Может быть выбрана, если тип объекта-устройства указан в Target. Это могут быть либо атрибуты сервера, либо общие атрибуты. Для всех остальных типов объектов используется область действия серверных атрибутов.
- **Серверные / общие атрибуты** - key/value-таблица, отображающая значения атрибутов, которые нужно обновить.

#### Отправка RPC - запросов на устройство

Позволяет запланировать вызов ([RPC](/docs/user-guide/rpc/#server-side-rpc-api)) для устройства или группы устройств.

![image](/images/user-guide/ui/scheduler-send-rpc-request-event-type.png)

- **Цель** - целевое устройство, на которое должна быть отправлена команда, может быть одиночным устройством или их [группой](/docs/user-guide/groups/).
- **Метод** - метод вызова RPC.
- **Параметры** - параметры RPC вызова в JSON-представлении.

### Виджет планировщика

Платформа предоставляет возможность управлять событиями планировщика с помощью виджетов Scheduler events или Reports schedule, которые являются частью пакета Scheduling Widgets

![image](/images/user-guide/ui/scheduler-scheduler-events-widget.png)

Виджет событий планировщика имеет те же возможности, что и страница событий планировщика. Кроме того, он может быть настроен с помощью предустановленных форм для пользовательских типов событий планировщика. Это можно сделать путем настройки списка «пользовательских типов событий» во вкладке «Дополнительно» конфигурации виджета.

![image](/images/user-guide/ui/scheduler-scheduler-events-widget-custom-types.png)

- **Display name** - отображаемое имя пользовательского типа события.
- **Type name** - внутреннее имя пользовательского события.
- **Display originator entity select** - разрешить ли выбор отправителя в форме конфигурации событий планировщика.
- **Display message type select** - разрешить ли выбор типа сообщения в форме конфигурации событий планировщика.
- **Display message metadata table** - следует ли отображать таблицу метаданных в форме конфигурации событий планировщика.
- **Configuration HTML template** - HTML-код, нужный для создания пользовательской формы конфигурации события, используемой для редактирования объекта конфигурации события.

