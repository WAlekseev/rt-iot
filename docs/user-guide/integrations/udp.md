---
layout: docwithnav
title: UDP интеграция
description: руководство по UDP интеграции 
---

* TOC
{:toc}

## Обзор

UDP интеграция позволяет передавать данные с устройств, которые используют протокол UDP, на IoT платформу Ростелеком и конвертировать полезную нагрузку этих устройств в поддерживаемый платформой формат.

Для получения большей информации изучите диаграмму интеграции.

![image](/images/user-guide/integrations/udp-integration.svg)

## Настройка UDP интеграции

### Предусловия

В данном руководстве мы воспользуемся:

 - UDP интеграцией, которая запущена удалённо и подключена к облачной платформе;
 - командой **echo**, которая предназначена для отображения строки текста и перенаправления результатов в утилиту **netcat** (**nc**);
 - утилитой **netcat** (**nc**) для установки UDP-связей, получения и преобразования данных;    

Предположим, что у нас есть датчик, который посылает текущие показания температуры и влажности.
Наш датчик **SN-001** публикует температуру и показатели влажности в UDP интеграцию по порту **11560** в машину, где данная интеграция запущена.

Для наглядного примера предположим, что наше устройство достаточно умное для отправки данных в трёх разных форматах полезной нагрузки:
 - **Text** - в этом случае полезная нагрузка выглядит так - **SN-001,default,temperature,25.7,humidity,69**
 - **JSON** - в этом случае полезная нагрузка выглядит так
 
```json
[
  {
    "deviceName": "SN-001",
    "deviceType": "default",
    "temperature": 25.7,
    "humidity": 69
  }
]
```
 - **Двоичный формат** - **\x53\x4e\x2d\x30\x30\x31\x64\x65\x66\x61\x75\x6c\x74\x32\x35\x2e\x37** (шестнадцатиричная строка). 
 Описание байтов в этой полезной нагрузке:
    - **0-5** байт - **\x53\x4e\x2d\x30\x30\x31** - имя устройства. Если мы конвертируем его в текстовый формат - **SN-001**;
    - **6-12** байт - **\x64\x65\x66\x61\x75\x6c\x74** - тип устройства. В текстовом формате - **default**;
    - **13-16** байт - **\x32\x35\x2e\x37** - телеметрия температуры. В текстовом формате - **25.7**;

  - **Hex** - в этом случае полезная нагрузка передается шестнадцатиричной строкой **534e2d30303164656661756c7432352e373639**. 
   Описание байтов в этой полезной нагрузке:
     - **0-5** байт - **534e2d303031** - имя устройства. В текстовом формате - **SN-001**;
     - **6-12** байт - **64656661756c74** - тип устройства. В текстовом формате - **default**;   
     - **13-16** байт - **32352e37** - телеметрия температуры. В текстовом формате - **25.7**;    
     - **17-18** байт - **3639** - телеметрия влажности. В текстовом формате - **69**;    
    
Вы можете выбрать тип полезной нагрузки в зависимости от возможностей вашего устройства и бизнес-кейсов.
 
 **Внимание**: порт **11560**, который используется на машине, в которой запущена UDP интеграция, должен быть открыт для входящих связей - должно быть возможным подключить утилиту **nc** к UDP сокету.
Если вы запускаете интеграцию локально, она должна успешно работать без каких-либо дополнительных изменений.

### Конвертер данных от устройства

Перед тем, как запускать **UDP интеграцию**, нужно создать **Конвертер от устройства**: скрипт для парсинга и преобразования данных, получаемых через UDP интеграцию.

Чтобы создать конвертер, перейдите в раздел **Конвертеры данных** и нажмите **Добавить новый конвертер данных —> Создать новый конвертер**.
Назовите его как **"UDP Uplink Converter"** и выберите тип **Uplink**. Включите режим отладки.

**Примечание**: режим отладки необходим для процесса разработки и устранения неисправностей, однако, оставляя данный режим включенным, вы рискуете значительно увеличить дисковое пространство, используемое базой данных. Так как все данные, полученные в данном режиме, записываются на этот диск. Поэтому настоятельно рекомендуем выключать режим сразу по завершении процесса отладки.

Выберете формат данных полезной нагрузки сообщения для настройки декодера

{% capture uplinkpayload %}
Текстовый<br/>%,%text%,%templates/integration/udp/udp-uplink-converter-text.md%br%
JSON<br/>%,%json%,%templates/integration/udp/udp-uplink-converter-json.md%br%
Двоичный<br/>%,%binary%,%templates/integration/udp/udp-uplink-converter-binary.md%br%
Hex<br/>%,%hex%,%templates/integration/udp/udp-uplink-converter-hex.md{% endcapture %}

{% include content-toggle.html content-toggle-id="udpintegartionuplinkpayload" toggle-spec=uplinkpayload %}

#### Конвертер данных к устройству

**На данный момент UDP интеграция не поддерживает данный функционал**

### Установка UDP интеграции

Перейдите в раздел **Интеграции** и нажмите кнопку **Добавить новую интеграцию**. Назовите ее **UDP Integration**, выберете тип **UDP**, включите режим отладки и в раскрывающемся меню добавьте недавно созданный конвертер данных от устройства.

Функция **Выполнять удаленно** включена и не может быть изменена - UDP интеграция может быть только под типом**remote**.

Запишите **Ключ интеграции** и **Секрет интеграции** - эти значения понадобятся в дальнейшем для настройки удаленной UPD интеграции.

![image](/images/user-guide/integrations/udp/udp-integration-setup.png)

По умолчанию UDP интеграция будет использовать порт **11560**, но вы можете поменять его на любой доступный порт. 

Остальные настройки мы оставляем по умолчанию. Короткое описание данных настроек:
- **Включить broadcast - интеграция будет принимать пакеты адресов broadcast** - флаг, указывающий, что интеграция будет принимать UDP-пакеты, отправленные на широковещательный адрес;
- **Размер буфера для входящего сокета** - размер в KBytes буфера приема данных сокетаr;

Выберете тип данных полезной нагрузки сообщения для **Настройки обработчика**

{% capture handlerconfiguration %}
Текстовый<br/>%,%text%,%templates/integration/udp/udp-handler-configuration-text.md%br%
JSON<br/>%,%json%,%templates/integration/udp/udp-handler-configuration-json.md%br%
Двоичный<br/>%,%binary%,%templates/integration/udp/udp-handler-configuration-binary.md%br%
Hex<br/>%,%hex%,%templates/integration/udp/udp-handler-configuration-hex.md{% endcapture %}

{% include content-toggle.html content-toggle-id="udpintegrationhandlerconfiguration" toggle-spec=handlerconfiguration %}

Нажмите **Добавить** для сохранения интеграции.

#### Установка и запуск внешней UDP интеграции

В руководстве [Удаленная интеграция](/docs/user-guide/integrations/remote-integrations) можно найти необходимую информацию для установки сервиса UPD интеграции локально или на отдельной машине.

Используйте **Ключ интеграции** и **Секрет интеграции** из раздела выше для настройки вашей UDP интеграции.  

### Отправка сообщения от устройства

Когда создается UPS интеграция, запускается UDP сервер. И затем он ожидает получения данных с устройств.

Выберите тип данных полезной нагрузки для сообщений от устройства

{% capture senduplink %}
Текстовый<br/>%,%text%,%templates/integration/udp/udp-send-uplink-text.md%br%
JSON<br/>%,%json%,%templates/integration/udp/udp-send-uplink-json.md%br%
Двоичный<br/>%,%binary%,%templates/integration/udp/udp-send-uplink-binary.md%br%
Hex<br/>%,%hex%,%templates/integration/udp/udp-send-uplink-hex.md{% endcapture %}

{% include content-toggle.html content-toggle-id="udpintegrationsenduplink" toggle-spec=senduplink %}

Перейдя в **Группы устройств -> All**, вам нужно найти устройство **SN-001**, которое  работает с интеграцией.
Нажмите на устройство, перейдите в **Последнюю телеметрию**. Там вы увидите ключ "temperature" и его значение (25.7).

Если полезная нагрузка содержит телеметрию **humidity** telemetry, вы сможете увидеть ключ "humidity" и его значение (69).

