---
layout: docwithnav
title: Дополнительные узлы действий
description: Дополнительные узлы действий
---

Данные узлы выполняют различные действия на основе входящего сообщения.

* TOC
{:toc}

# Add To Group Node

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-add-to-group.png)

Данный узел добавляет сущность с типом Отправитель сообщения в [группу сущностей](/docs/user-guide/groups/). 

Допускаются следующие типы отправителей сообщений: **Customer**, **Asset**, **Device**.

Находит целевую группу сущностей по шаблону имени группы, а затем добавляет в эту группу сущность с типом Отправитель. Создает новую группу сущностей, если она не существует, и если выставлен флаг «Создать новую группу, если групп не существует».

Настройка:

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-add-to-group-config.png)

- **Group name pattern** - можно задать прямое имя группы или использовать шаблон, который преобразуется в имя группы, на основе метаданных сообщения.
- **Create new group if not exists** - создать новую группу, если групп не существует - если флажок установлен, будет создана новая группа сущностей.
- **Groups cache expiration time** - время истечения срока действия кэша групп - указывает максимальный интервал времени в секундах, разрешенный для хранения найденных записей группы сущностей. Значение 0 означает, что срок действия записей никогда не истечет.

Сообщение будет перенаправлено по цепочке **Failure** в следующих случаях:

- Если тип сущности Отправитель не поддерживается.
- Целевая группа сущностей не существует, а флажок «Создать новую группу, если групп не существует» не установлен.

В других случаях сообщение будет направлено по цепочке **Success**. 

<br/>

# Remove From Group Node

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-remove-from-group.png)

Данный узел удаляет сущность с типом Отправитель сообщения из [группы сущностей](/docs/user-guide/groups/).

Допускаются следующие типы отправителей сообщений: **Customer**, **Asset**, **Device**.

Находит целевую группу сущностей по шаблону имени группы, а затем удаляет исходную сущность из этой группы.

Настройки:

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-remove-from-group-config.png)

- **Group name pattern** - шаблон имени группы - можно задать прямое имя группы или использовать шаблон, который преобразуется в имя группы, на основе метаданных сообщения.
- **Groups cache expiration time** - время истечения срока действия кэша групп - указывает максимальный интервал времени в секундах, разрешенный для хранения найденных записей группы сущностей. Значение 0 означает, что срок действия записей никогда не истечет.

Сообщение будет направлено по цепочке **Failure** в следующих случаях:

- Если тип сущности Отправитель не поддерживается.
- Целевая группа сущностей не существует.

В других случаях сообщение будет перенаправлено по цепочке **Success**. 

<br/>

# Generate Report Node

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-generate-report.png)

Данный узел создает файлы отчетов, на базе данных в дашбордах.

Узел можно настроить для использования определенной конфигурации отчета или взять ее из тела входящего сообщения.

Режим, когда настройки отчета берутся из тела сообщения, обычно используется, когда сообщение генерируется событием [Планировщик генерирования событий](/docs/user-guide/scheduler/#generate-report).

Узел генерирования отчета вызывает [Reports Server](/docs/user-guide/reporting/#reports-server) для создания файла отчета с помощью указанного дашборда. 

Файл с отчетом сохраняется в базе данных с помощью функции [Файлового хранилища](/docs/user-guide/file-storage/) ссылка на этот файл хранится в поле вложений метаданных исходящего сообщения.

Поле **attachments** в метаданных может использоваться другими узлами правил для получения файла из базы данных. Например, узел преобразования сообщения в электронное письмо [**To Email Node**](/docs/user-guide/rule-engine-2-0/transformation-nodes/#to-email-node) ищет это поле и подготавливает вложения для электронной почты, которые используются узлом преобразования сообщения в электронное письмо для отправки почты с вложениями.

Настройки:

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-generate-report-config.png)

- **Use system reports server** - Использовать сервер системных отчетов - если этот параметр установлен, URL-адрес конечной точки сервера отчетов будет взят из конфигурации системы .
- **Reports server endpoint URL** - конечная точка URL-адреса [сервера отчетов](/docs/user-guide/reporting/#reports-server).
- **Use report config from message** - если флажок установлен, настройки генерирования отчета будут взяты из тела сообщения.
- **Base URL** - базовый URL пользовательского интерфейса платформы, который должен быть доступен серверу отчетов.
- **Dashboard** - дашборд, который будет использоваться для формирования отчетов.
- **Dashboard state parameter value** - значение параметра состояния дашборда - используется для указания целевого состояния дашборда для создания отчета. Можно установить автоматически, нажав кнопку, находящуюся справа от поля редактирования. Откроется диалоговое окно «Выберете состояние дашборда».       
- **Timezone** - часовой пояс, в котором целевой дашборд будет представлен в отчете.
- **Use dashboard timewindow** - использовать временной интервал дашборда - если данный флажок выставлен, то при генерировании отчета будет использоваться временной интервал, настроенный в целевом дашборде.
- **Timewindow** - Временной интервал, который будет использоваться при генерировании отчета.
- **Report name pattern** - шаблон названия отчета - шаблон названия файла с сгенерированным отчетом. В данном поле можно задать  шаблон названия, в котором будут содержаться дата и время в таком виде `%d{date-time pattern}`. Ссотрите [SimpleDateFormat](https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html) для подробностей.
- **Report type** - файл отчета может быть в формате  *PDF \| PNG \| JPEG*.
- **Use current user credentials** - использовать текущие учетные данные пользователя - если флажок установлен, учетные данные пользователя, создавшего эту конфигурацию отчета, будут использоваться для открытия пользовательского интерфейса дашборда во время генерирования отчета.
- **Customer user credentials** - учетные данные клиента - целевой клиент, учетные данные которого будут использоваться для открытия пользовательского интерфейса дашборда во время генерирования отчета.

**Generate Test Report** кнопка «Сгенерировать тестовый отчет» используется для тестирования. Нажав её, можно вызывать процесс генерирования отчета с заданными настройками. Полученный файл отчета будет автоматически загружен, если генерирование успешно выполнится. 

Сообщение будет направлено по цепочке **Failure** в следующих случаях: 

- Когда **Use report config from message** установлен и во входящих сообщениях не передается JSON-объект, содержащий валидные настройки отчета.
- Когда [Reports Server](/docs/user-guide/reporting/#reports-server) недоступен по указанному URL-адресу конечной точки.
- Когда [Reports Server](/docs/user-guide/reporting/#reports-server) завершает генерирование отчета ошибкой и возвращает соответствующее сообщеие о сбое. 

В остальных случаях сообщение будет направлено по цепочке **Success**.

<br/>

# Integration Downlink Node


![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-integration-downlink.png)

Данный узел направляет сообщение в выбранную [интеграцию](/docs/user-guide/integrations/) в виде нисходящего сообщения.
 
Сообщение будет передано в выбранную очередь нисходящей линии интеграции.

Настройки:

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-integration-downlink-config.png)

- **Integration** - целевая интеграция для обработки нисходящих сообщений.

**Failure**  - если сообщение push to Integration завершается неудачно, в противном случае цепочка **Success**.

<br/>

# REST Call Reply Node

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-rest-call-reply.png)

Данный узел отправляет ответ на вызов REST API, который был первоначально отправлен в движок правил.
Принимает сообщения любого типа. Пересылает входящее сообщение в качестве ответа на вызов REST API, отправленный в движок правил.

Настройки:

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-rest-call-reply-config.png)

<br/>

# Change Owner Node

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-change-owner-node.png)

Данный узел изменяет владельца сущности типа Создатель на выбранного владельца по типу:

- Тенант

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-change-owner-node-tenent-config.png)

- Клиент

![image](/images/user-guide/rule-engine-2-0/pe/nodes/action-change-owner-node-customer-config.png)

Узел правил находит целевого владельца по шаблону имени владельца, а затем изменяет владельца сущности типа Создатель.

- **Owner name pattern** - Шаблон имени владельца - может быть задано прямое имя клиента или может быть использован шаблон, по которому будет создано имя, на основе метаданных сообщения.
- **Create new owner if not exists** - Создать нового владельца, если владельцев нет – если данный флажок установлен, будет создан новый владелец (клиент).
- **Owner cache expiration time** - Время истечения срока действия кэша владельца - задает максимальный интервал времени в секундах, разрешенный для хранения найденных записей владельцев (клиентов). Значение 0 означает, что срок действия записей никогда не истечет.

Если сущность уже принадлежит этому владельцу или владелец сущности успешно изменен - сообщение отправляется по цепочке **Success**, в противном случае будет использоваться цепочка **Failure**.

<br/>
